{"version":3,"sources":["chat.js","dice2D.js","dice3D.js","dices.js","images.js","music.js","room.js","users.js","main.js","plugins.js"],"names":["Chat","room","messages","this","msgbox","myMessages","typing","editMode","$messages","$","$message","$content","$chat","init","Dice2D","id","type","color","box","value","parseInt","replace","split","radius","scale","transform","position","x","y","z","rotation","time","createMesh","Dices2D","width","height","w","h","cw","ch","scene","dices","copyto","obj","res","Array","i","length","copy","hasOwnProperty","constructor","makeGeometry","vertices","faces","tab","af","geom","THREE","Geometry","vertex","Vector3","fromArray","normalize","multiplyScalar","index","push","ii","fl","aa","Math","PI","j","Face3","faceVertexUvs","Vector2","cos","sin","computeFaceNormals","computeVertexNormals","boundingSphere","Sphere","idealTextColor","bgColor","nThreshold","components","getRGBComponents","bgDelta","R","G","B","r","substring","g","b","makeDiceMaterials","diceColor","faceLabels","size","margin","createTextTexture","text","backColor","undefined","canvas","document","createElement","context","getContext","font","fillStyle","fillRect","textAlign","textBaseline","fillText","texture","Texture","needsUpdate","materials","MeshPhongMaterial","materialOptions","map","makeD4Materials","createD4Text","translate","rotate","labels","Dice3D","DicesModels3D","renderer","render","camera","Dices3D","aspect","desk","light","Dice","rolls","cooldown","$item","pop","Dices","defaultDices","$dices","reset","Images","image","$zoom","LocalPlayer","music","audio","Audio","volet","YoutubePlayer","youtube","$musicUrl","$playLater","$playNow","Music","playlist","current","savedVolume","currentVolume","localPlayer","youtubePlayer","player","$play","$mute","$volume","$bar","find","$musicPlayer","$musicPopin","Room","socket","name","user","users","options","hasWebGLSupport","dice","window","innerWidth","innerHeight","Users","images","chat","$options","$roomName","$logout","optionsOpened","grabbed","ghost","$users","item","prototype","getMessageIndexById","addMessage","message","editable","getClass","data","c","admin","prive","isNewBox","command","showCommand","append","html","showLastDice","roll","scrollTop","scrollHeight","showError","error","showImage","editMessage","myIndex","indexOf","typingStart","that","clearTimeout","setTimeout","typingStop","emit","startEdit","focus","val","putCursorAtEnd","stopEdit","editPrev","editNext","checkEndEdit","on","e","preventDefault","myMsg","keyCode","destroy","off","removeAllListeners","css","top","left","lineHeight","fontSize","fontWeight","textShadow","update","values","acos","Date","now","ceil","random","result","remove","sqrt","d4","geometry","mass","inertia","d6","d8","d10","a","d12","p","q","d20","t","d100","specular","emissive","shininess","shading","FlatShading","diceLabels","d10Labels","d100Labels","model","mesh","Mesh","MeshFaceMaterial","castShadow","receiveShadow","quaternion","add","resize","min","wh","tan","far","updateProjectionMatrix","mw","max","set","target","setSize","WebGLRenderingContext","WebGLRenderer","antialias","alpha","CanvasRenderer","shadowMapEnabled","shadowMapSoft","setClearColor","Scene","fog","domElement","PerspectiveCamera","ambientLight","AmbientLight","SpotLight","shadowCameraNear","shadowCameraFar","shadowCameraFov","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","planeFragmentShader","ShaderChunk","join","planeMaterial","ShaderMaterial","uniforms","ShaderLib","vertexShader","fragmentShader","PlaneGeometry","addEventListener","bind","addClass","removeClass","each","d","show","sort","children","detach","exist","$this","hasClass","url","close","zoom","src","upload","shift","reader","FileReader","onload","evt","readAsDataURL","download","originalEvent","dataTransfer","files","attr","loginRoom","action","loading","joinRoom","createRoom","succes","settings","Cookies","expires","fadeOut","submit","click","cookie","get","ck","config","Config","io","body","appendChild","autoplay","loop","post","crawlSongs","song","parent","elem","songs","next","musiclist","title","start","track","play","pause","volume","v","console","log","parentNode","removeChild","onPlayerReady","event","parse","parseURL","onPlayerStateChange","YT","PlayerState","PLAYING","getPlaylistIndex","ENDED","getPlaylist","tag","firstScriptTag","getElementsByTagName","insertBefore","onYouTubeIframeAPIReady","Player","events","onReady","onStateChange","loadPlaylist","list","pauseVideo","playVideo","setVolume","load","l","className","mute","unmute","round","offsetX","offset","clientX","fadeIn","factory","define","amd","exports","module","_OldCookies","api","jQuery","noConflict","extend","arguments","attributes","key","converter","path","defaults","setMilliseconds","getMilliseconds","JSON","stringify","test","encodeURIComponent","String","decodeURIComponent","escape","toUTCString","domain","secure","cookies","rdecode","parts","slice","charAt","json","getJSON","apply","call","withConverter","fn","setSelectionRange","len","support","tested","gl","experimental","proxy","saveOptions","closeOptions","showOptions","location","href","contenu","customRoll","dices3D","prop","getUserByName","toLowerCase","getUserById","getIndexById","showUser","$caracs","$user","order","prepend","refreshTokens","addUser","unshift","removeUser","splice","u","tokens","ts","tok","grab","self","clone","outerWidth","appendTo","release","pageX","pageY","grabbing","items","outerHeight","after","before","ordering","connected","token","delay","stopPropagation"],"mappings":"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","file":"all.min.js","sourcesContent":["function Chat(room, messages)\r\n{\r\n\tthis.msgbox = 0;\r\n\tthis.room = room;\r\n\tthis.messages = [];\r\n\tthis.myMessages = [];\r\n\tthis.typing = null;\r\n\tthis.editMode = -1;\r\n\r\n\tthis.$messages = $(\"#messages\");\r\n\tthis.$message = $(\"#message\");\r\n\tthis.$content = $(\"#content\");\r\n\tthis.$chat = $(\"#chat\");\r\n\r\n\tthis.init(messages);\r\n}\r\n\r\nChat.prototype.getMessageIndexById = function(id)\r\n{\r\n\tfor (var i = this.messages.length - 1; i >= 0; i--)\r\n\t{\r\n\t\tif(this.messages[i].id == id)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\nChat.prototype.addMessage = function(message, editable)\r\n{\r\n\t// On garde aussi en référence uniquement mes messages\r\n\tif(message.user.name == this.room.user.name && editable)\r\n\t\tthis.myMessages.push(message);\r\n\r\n\tthis.messages.push(message);\r\n};\r\n\r\nChat.prototype.getClass = function(data) {\r\n\tvar c = '';\r\n\tif(data.user.name == this.room.user.name) c += ' me';\r\n\tif(data.user.admin) c += ' admin';\r\n\tif(data.prive) c += ' prive';\r\n\r\n\treturn c;\r\n};\r\n\r\nChat.prototype.isNewBox = function(data)\r\n{\r\n\treturn !(\r\n\t\tthis.messages.length > 0 &&\r\n\t\tthis.messages[this.messages.length-1].user.name == data.user.name &&\r\n\t\t!this.messages[this.messages.length-1].command &&\r\n\t\t!this.messages[this.messages.length-1].image &&\r\n\t\tthis.messages[this.messages.length-1].prive == data.prive\r\n\t);\r\n};\r\n\r\nChat.prototype.showCommand = function(data)\r\n{\r\n\tswitch(data.command){\r\n\t\tcase \"/roll\":\r\n\t\t\tthis.$messages.append($('<li id=\"msgbox-'+(++this.msgbox)+'\" class=\"diceroll mui-panel'+this.getClass(data)+'\">').html('<span class=\"user\">'+((data.prive) ? data.user.name+' to '+data.prive : data.user.name)+':</span> '+data.message));\r\n\t\t\tthis.addMessage(data, false);\r\n\t\t\tthis.room.users.showLastDice(data.user, data.message);\r\n\t\t\tif(data.user.name == this.room.user.name) this.room.dices.roll(data.dice);\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tthis.$content.scrollTop(this.$content[0].scrollHeight);\r\n\r\n\treturn true;\r\n};\r\n\r\nChat.prototype.showError = function(data)\r\n{\r\n\tdata.user.name = \"error\";\r\n\tthis.$messages.append($('<li id=\"msgbox-'+(++this.msgbox)+'\" class=\"message '+data.error+' me\">').html(data.message));\r\n\tthis.addMessage(data, false);\r\n\tthis.$content.scrollTop(this.$content[0].scrollHeight);\r\n\treturn;\r\n};\r\n\r\nChat.prototype.showImage = function(data)\r\n{\r\n\tvar text = '<div id=\"image-'+data.image+'\"><a href=\"#\" data-image=\"'+data.image+'\">Download image '+data.name+'</a></div>';\r\n\tif(this.isNewBox(data))\r\n\t{\r\n\t\tthis.$messages.append(\r\n\t\t\t'<li id=\"msgbox-'+(++this.msgbox)+'\" class=\"message mui-panel'+this.getClass(data)+'\">'+\r\n\t\t\t\t'<div class=\"user\">'+((data.prive) ? data.user.name+' to '+data.prive : data.user.name)+':</div> '+\r\n\t\t\t\t'<div class=\"text\">'+text+'</div>'+\r\n\t\t\t'</li>'\r\n\t\t);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#msgbox-'+this.msgbox).find('.text').append(text);\r\n\t}\r\n\t\r\n\tthis.addMessage(data, false);\r\n\tthis.$content.scrollTop(this.$content[0].scrollHeight);\r\n};\r\n\r\nChat.prototype.message = function(data)\r\n{\r\n\tif(data.error){\r\n\t\tthis.showError(data);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(data.command){\r\n\t\tthis.showCommand(data);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(typeof data.image !== \"undefined\"){\r\n\t\tthis.showImage(data);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(this.isNewBox(data))\r\n\t{\r\n\t\t// Nouvelle box\r\n\t\tthis.$messages.append(\r\n\t\t\t'<li id=\"msgbox-'+(++this.msgbox)+'\" class=\"message mui-panel'+this.getClass(data)+'\">'+\r\n\t\t\t\t'<div class=\"user\">'+((data.prive) ? data.user.name+' to '+data.prive : data.user.name)+':</div> '+\r\n\t\t\t\t'<div class=\"text\"><div id=\"msg-'+data.id+'\">'+data.message+'</div></div>'+\r\n\t\t\t'</li>'\r\n\t\t);\r\n\t} \r\n\telse\r\n\t{\r\n\t\t// On ne crée pas de nouvelle box\r\n\t\t$('#msgbox-'+this.msgbox).find('.text').append('<div id=\"msg-'+data.id+'\">'+data.message+'</div>');\r\n\t}\r\n\r\n\tthis.addMessage(data, true);\r\n\tthis.$content.scrollTop(this.$content[0].scrollHeight);\r\n};\r\n\r\nChat.prototype.editMessage = function(data)\r\n{\r\n\t// Errors, command and images aren't editable\r\n\tif(data.error || data.command || data.image) return;\r\n\r\n\tvar index = this.getMessageIndexById(data.id);\r\n\tif(index >= 0)\r\n\t{\r\n\t\tvar myIndex = this.myMessages.indexOf(this.messages[index]);\r\n\t\tif(myIndex >= 0)\r\n\t\t\tthis.myMessages[myIndex] = data;\r\n\r\n\t\tthis.messages[index] = data;\r\n\t\t$(\"#msg-\"+data.id).html(data.message);\r\n\t}\r\n};\r\n\r\nChat.prototype.typingStart = function()\r\n{\r\n\tvar that = this;\r\n\tif(this.typing)\r\n\t{\r\n\t\t// Si typing en cours, on update\r\n\t\tclearTimeout(this.typing);\r\n\t\tthis.typing = setTimeout(function(){ that.typingStop(); }, 2500);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// Sinon on emet l'info\r\n\t\tthis.room.socket.emit('typing start');\r\n\t\tthis.typing = setTimeout(function(){ that.typingStop(); }, 2500);\r\n\t}\r\n};\r\n\r\nChat.prototype.typingStop = function()\r\n{\r\n\tclearTimeout(this.typing);\r\n\tthis.typing = null;\r\n\tthis.room.socket.emit('typing stop');\r\n};\r\n\r\nChat.prototype.startEdit = function()\r\n{\r\n\tif(this.editMode >= 0){\r\n\t\tvar that = this;\r\n\t\tthis.$message.focus();\r\n\t\tthis.$message.val(this.myMessages[this.editMode].message);\r\n\t\tsetTimeout(function(){ that.$message.putCursorAtEnd(); }, 0);\r\n\t}\r\n};\r\n\r\nChat.prototype.stopEdit = function()\r\n{\r\n\tif(this.editMode >= 0){\r\n\t\tthis.$message.val(\"\");\r\n\t\tthis.editMode = -1;\r\n\t}\r\n};\r\n\r\nChat.prototype.editPrev = function()\r\n{\r\n\tif(this.editMode <= 0)\r\n\t\tthis.editMode = this.myMessages.length;\r\n\r\n\t--this.editMode;\r\n\tthis.startEdit();\r\n};\r\n\r\nChat.prototype.editNext = function()\r\n{\r\n\t++this.editMode;\r\n\r\n\tif(this.editMode >= this.myMessages.length)\r\n\t{\r\n\t\tthis.stopEdit();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.startEdit();\r\n\t}\r\n};\r\n\r\nChat.prototype.checkEndEdit = function() \r\n{\r\n\tif(this.$message.val() == \"\")\r\n\t{\r\n\t\tthis.editMode = -1;\r\n\t}\r\n};\r\n\r\nChat.prototype.init = function(messages)\r\n{\r\n\tvar that = this;\r\n\r\n\t// Ajouter messages existants\r\n\tfor (i = 0, length = messages.length; i < length; i++) {\r\n\t\tthis.message(messages[i]);\r\n\t}\r\n\r\n\t// Envoyer message\r\n\tthis.$chat.on(\"submit.chat\", function(e){\r\n\t\te.preventDefault();\r\n\r\n\t\tvar message = that.$message.val();\r\n\r\n\t\tif(message != \"\")\r\n\t\t{\r\n\t\t\tif (that.editMode >= 0)\r\n\t\t\t{\r\n\t\t\t\tvar myMsg = that.myMessages[that.editMode];\r\n\t\t\t\tif(myMsg.prive)\r\n\t\t\t\t\tmessage = \"@\"+myMsg.prive+\" \"+message;\r\n\r\n\t\t\t\tthat.room.socket.emit(\"chat edit\", myMsg.id, message);\r\n\t\t\t\tthat.stopEdit();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthat.room.socket.emit(\"chat\", message);\r\n\t\t\t}\r\n\r\n\t\t\tthat.$message.val('');\r\n\t\t\tthat.checkEndEdit();\r\n\t\t\tthat.typingStop();\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t});\r\n\r\n\t// Recevoir messages\r\n\tthis.room.socket.on('chat', function(data){\r\n\t\tthat.message(data);\r\n\t});\r\n\r\n\t// Gestion du typing\r\n\tthis.$message.on(\"keypress.chat\", function(e){\r\n\t\t// e.keyCode : 8 back, 13 entrée\r\n\t\tif(e.keyCode != 8 && e.keyCode != 13)\r\n\t\t{\r\n\t\t\tthat.typingStart();\r\n\t\t}\r\n\t});\r\n\r\n\t// Gestion de l'édition\r\n\tthis.room.socket.on('chat edit', function(data){\r\n\t\tthat.editMessage(data);\r\n\t});\r\n\r\n\tthis.$message.on(\"keydown.chat\", function(e){\r\n\t\t// Key up\r\n\t\tif(e.keyCode == 38)\r\n\t\t{\r\n\t\t\tthat.editPrev();\r\n\t\t}\r\n\t\t// Key down\r\n\t\telse if(e.keyCode == 40)\r\n\t\t{\r\n\t\t\tthat.editNext();\r\n\t\t}\r\n\t\t// Key return or suppr\r\n\t\telse if(e.keyCode == 8 || e.keyCode == 46)\r\n\t\t{\r\n\t\t\tthat.checkEndEdit();\r\n\t\t}\r\n\t});\r\n};\r\n\r\nChat.prototype.destroy = function()\r\n{\r\n\tthis.$chat.off(\".chat\");\r\n\tthis.$message.off(\".chat\");\r\n\tthis.room.socket.removeAllListeners('chat');\r\n\tthis.room.socket.removeAllListeners('chat edit');\r\n};","\"use strict\";\r\n\r\nfunction Dice2D(id, type, color, box)\r\n{\r\n\tthis.id = id;\r\n\tthis.type = type;\r\n\tthis.value = parseInt(this.type.replace('d', '').split(' ')[0]);\r\n\tthis.box = box;\r\n\tthis.radius = 0.25 * this.box.scale;\r\n\tthis.color = color;\r\n\tthis.transform;\r\n\r\n\tthis.position = {x: 0, y: 0, z: 0};\r\n\tthis.rotation = 0;\r\n\tthis.time = 0;\r\n\r\n\tthis.createMesh();\r\n}\r\n\r\nDice2D.prototype.createMesh = function()\r\n{\r\n\tthis.transform = $('<div class=\"dice '+this.type+'\"></div>').css({\r\n\t\tposition: \"absolute\",\r\n\t\ttop: -this.radius,\r\n\t\tleft: -this.radius,\r\n\t\twidth: this.radius * 2,\r\n\t\theight: this.radius * 2,\r\n\t\tlineHeight: this.radius * 2 + \"px\",\r\n\t\tfontSize: this.radius * 0.75 + \"px\",\r\n\t\tfontWeight: \"bold\",\r\n\t\ttextShadow: \"2px 2px 0px #000000, 2px -2px 0px #000000, -2px -2px 0px #000000, -2px 2px 0px #000000\"\r\n\t});\r\n\r\n\tthis.box.scene.append(this.transform);\r\n};\r\n\r\nDice2D.prototype.update = function(values)\r\n{\r\n\tthis.position.x = values[0] * this.box.w / 1000 / 2 + this.box.cw;\r\n\tthis.position.y = this.box.ch - values[1] * this.box.h / 1000 / 2;\r\n\tthis.position.z = values[2];\r\n\tthis.rotation = (((2 * Math.acos(values[3])) * 180 / Math.PI) + 180) % 360;\r\n\r\n\tthis.transform.css(\"transform\", \"translate3d(\"+this.position.x+\"px, \"+this.position.y+\"px, \"+this.position.z+\"px) rotate(\"+this.rotation+\"deg)\");\r\n\tif(Date.now() - this.time > 166){\r\n\t\tthis.transform.html(Math.ceil(Math.random() * this.value));\r\n\t\tthis.time = Date.now();\r\n\t}\r\n};\r\n\r\nDice2D.prototype.result = function(value)\r\n{\r\n\tthis.transform.html(value);\r\n};\r\n\r\nDice2D.prototype.remove = function() {\r\n\tthis.transform.remove();\r\n\tdelete this.box.dices[this.id];\r\n};\r\n\r\nfunction Dices2D(room, width, height)\r\n{\r\n\tthis.room = room;\r\n\tthis.w = width;\r\n\tthis.h = height;\r\n\tthis.cw;\r\n\tthis.ch;\r\n\tthis.scale;\r\n\tthis.scene;\r\n\r\n\tthis.dices = {};\r\n\r\n\tthis.init();\r\n}\r\n\r\nDices2D.prototype.init = function()\r\n{\r\n\tvar that = this;\r\n\r\n\tthis.cw = this.w / 2;\r\n\tthis.ch = this.h / 2;\r\n\tthis.scale = Math.sqrt(this.w * this.w + this.h * this.h) / 13;\r\n\r\n\tthis.dices = {};\r\n\tthis.scene = $(\"#dice-box\");\r\n\r\n\tthis.room.socket.on('dice start', function(data){\r\n\t\tfor(var i = 0; i < data.length; i++){\r\n\t\t\tthat.dices[data[i].id] = new Dice2D(data[i].id, data[i].type, data[i].color, that);\r\n\t\t}\r\n\t});\r\n\r\n\tthis.room.socket.on('dice update', function(data){\r\n\t\tfor(var i in data){\r\n\t\t\tif(that.dices[i]) that.dices[i].update(data[i]);\r\n\t\t}\r\n\t});\r\n\r\n\tthis.room.socket.on('dice result', function(data){\r\n\t\tfor(var i in data){\r\n\t\t\tif(that.dices[i]) that.dices[i].result(data[i]);\r\n\t\t}\r\n\t});\r\n\r\n\tthis.room.socket.on('dice end', function(data){\r\n\t\tfor(var i = 0; i < data.length; i++){\r\n\t\t\tif(that.dices[data[i]]) that.dices[data[i]].remove();\r\n\t\t}\r\n\t});\r\n};\r\n\r\nDices2D.prototype.remove = function() {\r\n\tthis.room.socket.removeAllListeners('dice start');\r\n\tthis.room.socket.removeAllListeners('dice update');\r\n\tthis.room.socket.removeAllListeners('dice result');\r\n\tthis.room.socket.removeAllListeners('dice end');\r\n};","\"use strict\";\r\n\r\nvar DicesModels3D = {};\r\n\r\nDicesModels3D.d4 = {\r\n\tgeometry: {\r\n\t\tvertices: [[1, 1, 1], [-1, -1, 1], [-1, 1, -1], [1, -1, -1]],\r\n\t\tfaces: [[1, 0, 2, 1], [0, 1, 3, 2], [0, 3, 2, 3], [1, 2, 3, 4]],\r\n\t\ttab: -0.1,\r\n\t\taf: Math.PI * 7 / 6\r\n\t},\r\n\tmass: 300,\r\n\tinertia: 5,\r\n\tscale: 1\r\n};\r\n\r\nDicesModels3D.d6 = {\r\n\tgeometry: {\r\n\t\tvertices: [[-1, -1, -1], [1, -1, -1], [1, 1, -1], [-1, 1, -1], [-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1]],\r\n\t\tfaces: [[0, 3, 2, 1, 1], [1, 2, 6, 5, 2], [0, 1, 5, 4, 3], [3, 7, 6, 2, 4], [0, 4, 7, 3, 5], [4, 5, 6, 7, 6]],\r\n\t\ttab: 0.1,\r\n\t\taf: Math.PI / 4\r\n\t},\r\n\tmass: 300,\r\n\tinertia: 13,\r\n\tscale: 1.1\r\n};\r\n\r\nDicesModels3D.d8 = {\r\n\tgeometry: {\r\n\t\tvertices: [[1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0], [0, 0, 1], [0, 0, -1]],\r\n\t\tfaces: [[0, 2, 4, 1], [0, 4, 3, 2], [0, 3, 5, 3], [0, 5, 2, 4], [1, 3, 4, 5], [1, 4, 2, 6], [1, 2, 5, 7], [1, 5, 3, 8]],\r\n\t\ttab: 0,\r\n\t\taf: -Math.PI / 4 / 2\r\n\t},\r\n\tmass: 340,\r\n\tinertia: 10,\r\n\tscale: 1.1\r\n};\r\n\r\nDicesModels3D.d10 = {\r\n\tgeometry: {\r\n\t\tvertices: function(){\r\n\t\t\tvar a = Math.PI * 2 / 10, k = Math.cos(a), h = 0.105;\r\n\t\t\tvar vertices = [];\r\n\t\t\tfor (var i = 0, b = 0; i < 10; ++i, b += a)\r\n\t\t\t\tvertices.push([Math.cos(b), Math.sin(b), h * (i % 2 ? 1 : -1)]);\r\n\t\t\tvertices.push([0, 0, -1]); vertices.push([0, 0, 1]);\r\n\t\t\treturn vertices;\r\n\t\t}(),\r\n\t\tfaces: [\r\n\t\t\t[5, 7, 11, 0], [4, 2, 10, 1], [1, 3, 11, 2], [0, 8, 10, 3], [7, 9, 11, 4],\r\n\t\t\t[8, 6, 10, 5], [9, 1, 11, 6], [2, 0, 10, 7], [3, 5, 11, 8], [6, 4, 10, 9],\r\n\t\t\t[5, 6, 7, -1], [3, 2, 4, -1], [1, 2, 3, -1], [9, 8, 0, -1], [7, 8, 9, -1],\r\n\t\t\t[7, 6, 8, -1], [9, 0, 1, -1], [1, 0, 2, -1], [3, 4, 5, -1], [5, 4, 6, -1]\r\n\t\t],\r\n\t\ttab: 0,\r\n\t\taf: Math.PI * 6 / 5\r\n\t},\r\n\tmass: 350,\r\n\tinertia: 9,\r\n\tscale: 1\r\n};\r\n\r\nDicesModels3D.d12 = {\r\n\tgeometry: {\r\n\t\tvertices: function(){\r\n\t\t\tvar p = (1 + Math.sqrt(5)) / 2, q = 1 / p;\r\n\t\t\treturn [[0, q, p], [0, q, -p], [0, -q, p], [0, -q, -p], [p, 0, q], [p, 0, -q], [-p, 0, q], [-p, 0, -q], [q, p, 0], [q, -p, 0], [-q, p, 0], [-q, -p, 0], [1, 1, 1], [1, 1, -1], [1, -1, 1], [1, -1, -1], [-1, 1, 1], [-1, 1, -1], [-1, -1, 1], [-1, -1, -1]];\r\n\t\t}(),\r\n\t\tfaces: [[2, 14, 4, 12, 0, 1], [15, 9, 11, 19, 3, 2], [16, 10, 17, 7, 6, 3], [6, 7, 19, 11, 18, 4], [6, 18, 2, 0, 16, 5], [18, 11, 9, 14, 2, 6], [1, 17, 10, 8, 13, 7], [1, 13, 5, 15, 3, 8], [13, 8, 12, 4, 5, 9], [5, 4, 14, 9, 15, 10], [0, 12, 8, 10, 16, 11], [3, 19, 7, 17, 1, 12]],\r\n\t\ttab: 0.2,\r\n\t\taf: -Math.PI / 4 / 2\r\n\t},\r\n\tmass: 380,\r\n\tinertia: 8,\r\n\tscale: 1\r\n};\r\n\r\nDicesModels3D.d20 = {\r\n\tgeometry: {\r\n\t\tvertices: function(){\r\n\t\t\tvar t = (1 + Math.sqrt(5)) / 2;\r\n\t\t\treturn [[-1, t, 0], [1, t, 0 ], [-1, -t, 0], [1, -t, 0], [0, -1, t], [0, 1, t], [0, -1, -t], [0, 1, -t], [t, 0, -1], [t, 0, 1], [-t, 0, -1], [-t, 0, 1]];\r\n\t\t}(),\r\n\t\tfaces: [[0, 11, 5, 1], [0, 5, 1, 2], [0, 1, 7, 3], [0, 7, 10, 4], [0, 10, 11, 5], [1, 5, 9, 6], [5, 11, 4, 7], [11, 10, 2, 8], [10, 7, 6, 9], [7, 1, 8, 10], [3, 9, 4, 11], [3, 4, 2, 12], [3, 2, 6, 13], [3, 6, 8, 14], [3, 8, 9, 15], [4, 9, 5, 16], [2, 4, 11, 17], [6, 2, 10, 18], [8, 6, 7, 19], [9, 8, 1, 20]],\r\n\t\ttab: -0.2,\r\n\t\taf: -Math.PI / 4 / 2\r\n\t},\r\n\tmass: 400,\r\n\tinertia: 6,\r\n\tscale: 1\r\n};\r\n\r\nDicesModels3D.d100 = {\r\n\tgeometry: DicesModels3D.d10.geometry,\r\n\tmass: 350,\r\n\tinertia: 9,\r\n\tscale: 1\r\n};\r\n\r\nfunction copyto(obj, res) {\r\n\tif (obj == null || typeof obj !== 'object') return obj;\r\n\tif (obj instanceof Array) {\r\n\t\tfor (var i = obj.length - 1; i >= 0; --i)\r\n\t\t\tres[i] = copy(obj[i]);\r\n\t}\r\n\telse {\r\n\t\tfor (var i in obj) {\r\n\t\t\tif (obj.hasOwnProperty(i))\r\n\t\t\t\tres[i] = copy(obj[i]);\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n}\r\n\r\nfunction copy(obj) {\r\n\tif (!obj) return obj;\r\n\treturn copyto(obj, new obj.constructor());\r\n}\r\n\r\nfunction makeGeometry(vertices, faces, radius, tab, af) {\r\n\tvar geom = new THREE.Geometry();\r\n\tfor (var i = 0; i < vertices.length; ++i) {\r\n\t\tvar vertex = (new THREE.Vector3).fromArray(vertices[i]).normalize().multiplyScalar(radius);\r\n\t\tvertex.index = geom.vertices.push(vertex) - 1;\r\n\t}\r\n\tfor (var i = 0; i < faces.length; ++i) {\r\n\t\tvar ii = faces[i], fl = ii.length - 1;\r\n\t\tvar aa = Math.PI * 2 / fl;\r\n\t\tfor (var j = 0; j < fl - 2; ++j) {\r\n\t\t\tgeom.faces.push(new THREE.Face3(ii[0], ii[j + 1], ii[j + 2], [geom.vertices[ii[0]],\r\n\t\t\t\t\t\tgeom.vertices[ii[j + 1]], geom.vertices[ii[j + 2]]], 0, ii[fl] + 1));\r\n\t\t\tgeom.faceVertexUvs[0].push([\r\n\t\t\t\t\tnew THREE.Vector2((Math.cos(af) + 1 + tab) / 2 / (1 + tab),\r\n\t\t\t\t\t\t(Math.sin(af) + 1 + tab) / 2 / (1 + tab)),\r\n\t\t\t\t\tnew THREE.Vector2((Math.cos(aa * (j + 1) + af) + 1 + tab) / 2 / (1 + tab),\r\n\t\t\t\t\t\t(Math.sin(aa * (j + 1) + af) + 1 + tab) / 2 / (1 + tab)),\r\n\t\t\t\t\tnew THREE.Vector2((Math.cos(aa * (j + 2) + af) + 1 + tab) / 2 / (1 + tab),\r\n\t\t\t\t\t\t(Math.sin(aa * (j + 2) + af) + 1 + tab) / 2 / (1 + tab))]);\r\n\t\t}\r\n\t}\r\n\tgeom.computeFaceNormals();\r\n\tgeom.computeVertexNormals();\r\n\tgeom.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\treturn geom;\r\n}\r\n\r\nvar materialOptions = {\r\n\tspecular: '#171d1f',\r\n\tcolor: '#ffffff',\r\n\temissive: '#000000',\r\n\tshininess: 7,\r\n\tshading: THREE.FlatShading,\r\n};\r\n\r\nvar diceLabels = [' ', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20'];\r\nvar d10Labels = [' ', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0'];\r\nvar d100Labels = [' ', '10', '20', '30', '40', '50', '60', '70', '80', '90', '00'];\r\n\r\nfunction idealTextColor(bgColor) {\r\n\r\n   var nThreshold = 105;\r\n   var components = getRGBComponents(bgColor);\r\n   var bgDelta = (components.R * 0.299) + (components.G * 0.587) + (components.B * 0.114);\r\n\r\n   return ((255 - bgDelta) < nThreshold) ? \"#000000\" : \"#ffffff\";\r\n}\r\n\r\nfunction getRGBComponents(color) {\r\n\r\n    var r = color.substring(1, 3);\r\n    var g = color.substring(3, 5);\r\n    var b = color.substring(5, 7);\r\n\r\n    return {\r\n       R: parseInt(r, 16),\r\n       G: parseInt(g, 16),\r\n       B: parseInt(b, 16)\r\n    };\r\n}\r\n\r\nfunction makeDiceMaterials(diceColor, faceLabels, size, margin) {\r\n\tfunction createTextTexture(text, color, backColor) {\r\n\t\tif (text == undefined) return null;\r\n\t\tvar canvas = document.createElement(\"canvas\");\r\n\t\tvar context = canvas.getContext(\"2d\");\r\n\t\tcanvas.width = size + margin;\r\n\t\tcanvas.height = size + margin;\r\n\t\tcontext.font = size + \"pt Arial\";\r\n\t\tcontext.fillStyle = backColor;\r\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\r\n\t\tcontext.textAlign = \"center\";\r\n\t\tcontext.textBaseline = \"middle\";\r\n\t\tcontext.fillStyle = color;\r\n\t\tcontext.fillText(text, canvas.width / 2, canvas.height / 2);\r\n\t\tif (text == '6' || text == '9') {\r\n\t\t\tcontext.fillText('  .', canvas.width / 2, canvas.height / 2);\r\n\t\t}\r\n\t\tvar texture = new THREE.Texture(canvas);\r\n\t\ttexture.needsUpdate = true;\r\n\t\treturn texture;\r\n\t}\r\n\tvar materials = [];\r\n\tfor (var i = 0; i < faceLabels.length; ++i)\r\n\t\tmaterials.push(new THREE.MeshPhongMaterial(copyto(materialOptions, { map: createTextTexture(faceLabels[i], idealTextColor(diceColor), diceColor) })));\r\n\r\n\treturn materials;\r\n}\r\n\r\nfunction makeD4Materials(diceColor, size, margin) {\r\n\tfunction createD4Text(text, color, backColor) {\r\n\t\tvar canvas = document.createElement(\"canvas\");\r\n\t\tvar context = canvas.getContext(\"2d\");\r\n\t\tcanvas.width = size + margin;\r\n\t\tcanvas.height = size + margin;\r\n\t\tcontext.font = size + \"pt Arial\";\r\n\t\tcontext.fillStyle = backColor;\r\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\r\n\t\tcontext.textAlign = \"center\";\r\n\t\tcontext.textBaseline = \"middle\";\r\n\t\tcontext.fillStyle = color;\r\n\t\tcontext.translate(0, size / 10);\r\n\t\tfor (var i in text) {\r\n\t\t\tcontext.fillText(text[i], canvas.width / 2,\r\n\t\t\t\t\tcanvas.height / 2 - size - margin / 10);\r\n\t\t\tcontext.translate(canvas.width / 2, canvas.height / 2);\r\n\t\t\tcontext.rotate(Math.PI * 2 / 3);\r\n\t\t\tcontext.translate(-canvas.width / 2, -canvas.height / 2);\r\n\t\t}\r\n\t\tvar texture = new THREE.Texture(canvas);\r\n\t\ttexture.needsUpdate = true;\r\n\t\treturn texture;\r\n\t}\r\n\tvar materials = [];\r\n\tvar labels = [[], [0, 0, 0], [2, 4, 3], [1, 3, 4], [2, 1, 4], [1, 2, 3]];\r\n\tfor (var i = 0; i < labels.length; ++i)\r\n\t\tmaterials.push(new THREE.MeshPhongMaterial(copyto(materialOptions, { map: createD4Text(labels[i], idealTextColor(diceColor), diceColor) })));\r\n\treturn materials;\r\n}\r\n\r\nfunction Dice3D(id, type, color, box)\r\n{\r\n\tthis.id = id;\r\n\tthis.type = type;\r\n\tthis.box = box;\r\n\tthis.radius = 0.6 * DicesModels3D[this.type].scale * box.scale;\r\n\tthis.color = color;\r\n\tthis.transform;\r\n\r\n\t//this.position = {x: 0, y: 0, z: 0};\r\n\t//this.rotation = {x: 0, y: 0, z: 0, w: 0};\r\n\r\n\tthis.createMesh();\r\n\r\n\tthis.box.renderer.render(this.box.scene, this.box.camera);\r\n}\r\n\r\nDice3D.prototype.createMesh = function()\r\n{\r\n\tvar model = DicesModels3D[this.type];\r\n\tvar geometry = makeGeometry(model.geometry.vertices, model.geometry.faces, this.radius, model.geometry.tab, model.geometry.af);\r\n\r\n\tvar materials;\r\n\tif(this.type == 'd4'){\r\n\t\tmaterials = makeD4Materials(this.color, this.box.scale / 3, this.box.scale);\r\n\t} else if(this.type == 'd100') {\r\n\t\tmaterials = makeDiceMaterials(this.color, d100Labels, this.box.scale / 3, this.box.scale);\r\n\t} else if(this.type == 'd10') {\r\n\t\tmaterials = makeDiceMaterials(this.color, d10Labels, this.box.scale / 3, this.box.scale);\r\n\t} else {\r\n\t\tmaterials = makeDiceMaterials(this.color, diceLabels, this.box.scale / 3, this.box.scale);\r\n\t}\r\n\r\n\tvar mesh = new THREE.Mesh( geometry, new THREE.MeshFaceMaterial( materials )  );\r\n\r\n\tmesh.castShadow = true;\r\n\tmesh.receiveShadow = false;\r\n\r\n\tmesh.position.x = -this.box.w * 2;\r\n\tmesh.position.y = -this.box.h * 2;\r\n\tmesh.position.z = 0;\r\n\r\n\tmesh.quaternion.x = 0;\r\n\tmesh.quaternion.y = 0;\r\n\tmesh.quaternion.z = 0;\r\n\tmesh.quaternion.w = 0;\r\n\r\n\tthis.transform = mesh;\r\n\tthis.box.scene.add(mesh);\r\n};\r\n\r\nDice3D.prototype.update = function(values)\r\n{\r\n\tthis.transform.position.x = values[0] * this.box.w / 1000;\r\n\tthis.transform.position.y = values[1] * this.box.h / 1000;\r\n\tthis.transform.position.z = values[2];\r\n\r\n\tthis.transform.quaternion.x = values[3];\r\n\tthis.transform.quaternion.y = values[4];\r\n\tthis.transform.quaternion.z = values[5];\r\n\tthis.transform.quaternion.w = values[6];\r\n};\r\n\r\nDice3D.prototype.remove = function() {\r\n\tthis.box.scene.remove(this.transform);\r\n\tdelete this.box.dices[this.id];\r\n};\r\n\r\nfunction Dices3D(room, width, height)\r\n{\r\n\tthis.room = room;\r\n\tthis.w = width;\r\n\tthis.h = height;\r\n\tthis.cw;\r\n\tthis.ch;\r\n\tthis.scene;\r\n\tthis.camera;\r\n\tthis.renderer;\r\n\tthis.aspect;\r\n\tthis.scale;\r\n\tthis.desk;\r\n\tthis.light;\r\n\r\n\tthis.dices = {};\r\n\r\n\tthis.init();\r\n}\r\n\r\nDices3D.prototype.resize = function()\r\n{\r\n\tthis.w = window.innerWidth;\r\n\tthis.h = window.innerHeight;\r\n\tthis.cw = this.w / 2;\r\n\tthis.ch = this.h / 2;\r\n\tthis.aspect = Math.min(this.cw / this.w, this.ch / this.h);\r\n\tthis.scale = Math.sqrt(this.w * this.w + this.h * this.h) / 13;\r\n\r\n\tvar wh = Math.min(this.cw, this.ch) / this.aspect / Math.tan(10 * Math.PI / 180);\r\n\tthis.camera.aspect = this.cw / this.ch;\r\n\tthis.camera.far = wh * 1.3;\r\n\tthis.camera.position.z = wh;\r\n\tthis.camera.updateProjectionMatrix();\r\n\r\n\tvar mw = Math.max(this.w, this.h);\r\n\tthis.light.position.set(-mw / 2, mw / 2, mw * 2);\r\n\tthis.light.target.position.set(0, 0, 0);\r\n\r\n\tthis.renderer.setSize(this.w, this.h);\r\n};\r\n\r\nDices3D.prototype.init = function()\r\n{\r\n\tvar that = this;\r\n\r\n\tthis.cw = this.w / 2;\r\n\tthis.ch = this.h / 2;\r\n\r\n\tthis.aspect = Math.min(this.cw / this.w, this.ch / this.h);\r\n\tthis.scale = Math.sqrt(this.w * this.w + this.h * this.h) / 13;\r\n\r\n\tthis.renderer = window.WebGLRenderingContext\r\n\t\t? new THREE.WebGLRenderer({ antialias: true, alpha: true })\r\n\t\t: new THREE.CanvasRenderer({ antialias: true, alpha: true });\r\n\tthis.renderer.setSize(this.cw * 2, this.ch * 2);\r\n\tthis.renderer.shadowMapEnabled = true;\r\n\tthis.renderer.shadowMapSoft = true;\r\n\tthis.renderer.setClearColor(0x000000, 0);\r\n\r\n\tthis.dices = {};\r\n\tthis.scene = new THREE.Scene();\r\n\tthis.scene.fog = null;\r\n\r\n\t$(\"#dice-box\").append(this.renderer.domElement);\r\n\r\n\tvar wh = Math.min(this.cw, this.ch) / this.aspect / Math.tan(10 * Math.PI / 180);\r\n\tthis.camera = new THREE.PerspectiveCamera(20, this.cw / this.ch, 1, wh * 1.3);\r\n\tthis.camera.position.z = wh;\r\n\r\n\tvar ambientLight = new THREE.AmbientLight(0x666666);\r\n\tthis.scene.add(ambientLight);\r\n\r\n\tvar mw = Math.max(this.w, this.h);\r\n\tthis.light = new THREE.SpotLight(0xffffff);\r\n\tthis.light.position.set(-mw / 2, mw / 2, mw * 2);\r\n\tthis.light.target.position.set(0, 0, 0);\r\n\tthis.light.castShadow = true;\r\n\tthis.light.shadowCameraNear = mw / 10;\r\n\tthis.light.shadowCameraFar = mw * 3;\r\n\tthis.light.shadowCameraFov = 50;\r\n\tthis.light.shadowBias = 0.001;\r\n\tthis.light.shadowDarkness = 0.3;\r\n\tthis.light.shadowMapWidth = 1024;\r\n\tthis.light.shadowMapHeight = 1024;\r\n\tthis.scene.add(this.light);\r\n\r\n\tvar planeFragmentShader = [\r\n\r\n\t\t\"uniform vec3 diffuse;\",\r\n\t\t\"uniform float opacity;\",\r\n\r\n\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\tTHREE.ShaderChunk[ \"map_pars_fragment\" ],\r\n\t\tTHREE.ShaderChunk[ \"lightmap_pars_fragment\" ],\r\n\t\tTHREE.ShaderChunk[ \"envmap_pars_fragment\" ],\r\n\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\tTHREE.ShaderChunk[ \"specularmap_pars_fragment\" ],\r\n\r\n\t\t\"void main() {\",\r\n\r\n\t\t\t\"gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 );\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"map_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"specularmap_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"linear_to_gamma_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 - shadowColor.x );\",\r\n\r\n\t\t\"}\"\r\n\r\n\t].join(\"\\n\");\r\n\r\n\tvar planeMaterial = new THREE.ShaderMaterial({\r\n\t\tuniforms: THREE.ShaderLib['basic'].uniforms,\r\n\t\tvertexShader: THREE.ShaderLib['basic'].vertexShader,\r\n\t\tfragmentShader: planeFragmentShader,\r\n\t\tcolor: 0x0000FF\r\n\t});\r\n\r\n\tthis.desk = new THREE.Mesh(new THREE.PlaneGeometry(this.w*2, this.h*2, 1, 1), planeMaterial);\r\n\tthis.desk.receiveShadow = true;\r\n\tthis.scene.add(this.desk);\r\n\r\n\twindow.addEventListener('click', this.resize.bind(this));\r\n\r\n\tthis.room.socket.on('dice start', function(data){\r\n\t\tfor(var i = 0; i < data.length; i++){\r\n\t\t\tthat.dices[data[i].id] = new Dice3D(data[i].id, data[i].type, data[i].color, that);\r\n\t\t}\r\n\t});\r\n\r\n\tthis.room.socket.on('dice update', function(data){\r\n\t\tfor(var i in data){\r\n\t\t\tif(that.dices[i]) that.dices[i].update(data[i]);\r\n\t\t}\r\n\t\tthat.renderer.render(that.scene, that.camera);\r\n\t});\r\n\r\n\tthis.room.socket.on('dice end', function(data){\r\n\t\tfor(var i = 0; i < data.length; i++){\r\n\t\t\tif(that.dices[data[i]]) that.dices[data[i]].remove();\r\n\t\t}\r\n\t\tthat.renderer.render(that.scene, that.camera);\r\n\t});\r\n};\r\n\r\nDices3D.prototype.remove = function() {\r\n\tthis.room.socket.removeAllListeners('dice start');\r\n\tthis.room.socket.removeAllListeners('dice update');\r\n\tthis.room.socket.removeAllListeners('dice end');\r\n};\r\n","function Dice(type){\r\n\tthis.type = type;\r\n\tthis.rolls = 0;\r\n\tthis.cooldown = null;\r\n\tthis.$item = $('<div class=\"dice d'+type.split('d').pop()+' noselect\">'+type+'</div>');\r\n}\r\n\r\nDice.prototype.roll = function() {\r\n\tvar that = this;\r\n\t++this.rolls;\r\n\tthis.$item.addClass(\"cooldown\");\r\n\tclearTimeout(this.cooldown);\r\n\tthis.cooldown = setTimeout(function(){ that.$item.removeClass(\"cooldown\"); }, 2000);\r\n};\r\n\r\nfunction Dices(room, defaultDices)\r\n{\r\n\tthis.room = room;\r\n\tthis.defaultDices = defaultDices || [];\r\n\tthis.dices = [];\r\n\r\n\tthis.$dices = $(\"#dices\");\r\n\r\n\tthis.reset();\r\n\tthis.init();\r\n}\r\n\r\n// Clear dices\r\nDices.prototype.reset = function()\r\n{\r\n\tvar that = this;\r\n\tthis.dices = [];\r\n\t$.each(this.defaultDices, function(i, d){\r\n\t\tthat.roll(d);\r\n\t});\r\n};\r\n\r\n// Show dices\r\nDices.prototype.show = function()\r\n{\r\n\tthis.sort();\r\n\tvar length = this.dices.length;\r\n\tthis.$dices.children(\".dice\").detach();\r\n\tthis.$dices.css({width: 45 * length, height: 45 * length});\r\n\tfor(var i = 0; i < length; i++)\r\n\t\tthis.$dices.append(this.dices[i].$item);\r\n};\r\n\r\n// Sort dices by number of rolls\r\nDices.prototype.sort = function()\r\n{\r\n\tthis.dices.sort(function(a, b){ return b.rolls - a.rolls; });\r\n};\r\n\r\n// Show\r\nDices.prototype.roll = function(dice)\r\n{\r\n\t// Merge 1dX and dX\r\n\tdice = dice.split('d');\r\n\tif(dice[0] == \"1\")\r\n\t\tdice[0] = \"\";\r\n\tdice = dice.join('d');\r\n\r\n\tvar exist = false;\r\n\tfor (var i = this.dices.length - 1; i >= 0; i--) {\r\n\t\tif(this.dices[i].type == dice){\r\n\t\t\texist = true;\r\n\t\t\tthis.dices[i].roll();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tif(!exist) {\r\n\t\tthis.dices.push(new Dice(dice));\r\n\t}\r\n\r\n\tthis.show();\r\n};\r\n\r\nDices.prototype.init = function()\r\n{\r\n\tvar that = this;\r\n\r\n\t$(window).on('resize.dices', function(){\r\n\t\tthat.show();\r\n\t});\r\n\r\n\t$(document).on(\"click.dices\", \".dice\", function(e){\r\n\t\te.preventDefault();\r\n\t\tvar $this = $(this);\r\n\t\tif(!$this.hasClass(\"cooldown\")){\r\n\t\t\t$this.addClass(\"cooldown\");\r\n\t\t\tvar dice = $this.html();\r\n\t\t\tthat.room.socket.emit('chat', \"/roll \"+dice);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nDices.prototype.destroy = function()\r\n{\r\n\t$(window).off('.dices');\r\n\t$(document).off('.dices');\r\n};\r\n","function Images(room)\r\n{\r\n\tthis.room = room;\r\n\tthis.image = \"\";\r\n\r\n\tthis.$zoom = null;\r\n\r\n\tthis.init();\r\n}\r\n\r\nImages.prototype.show = function(data) {\r\n\t$(\"#image-\"+data.id).html('<img class=\"zoomable link\" src=\"'+data.url+'\" alt=\"'+data.name+'\" title=\"'+data.name+'\">');\r\n};\r\n\r\nImages.prototype.close = function()\r\n{\r\n\tif(this.$zoom)\r\n\t{\r\n\t\tthis.$zoom.off('.images');\r\n\t\tthis.$zoom.remove();\r\n\t\tthis.$zoom = null;\r\n\t}\r\n};\r\n\r\nImages.prototype.zoom = function(src)\r\n{\r\n\tif(!this.$zoom)\r\n\t{\r\n\t\tvar that = this;\r\n\t\tthis.$zoom = $('<div class=\"overlay centerer closable\"><div class=\"image centered\"><img class=\"zoomed\" src=\"'+src+'\" alt=\"\"></div></div>')\r\n\t\t$('body').append(this.$zoom);\r\n\t\tthis.$zoom.on('click.images', function(){\r\n\t\t\tthat.close();\r\n\t\t});\r\n\t}\r\n};\r\n\r\nImages.prototype.upload = function(image)\r\n{\r\n\tif(image.type.split('/').shift() == 'image')\r\n\t{\r\n\t\tvar that = this;\r\n\t\treader = new FileReader();\r\n\t\treader.onload = function(evt){\r\n\t\t\tthat.room.socket.emit('image upload', image.name, evt.target.result);\r\n\t\t};\r\n\t\treader.readAsDataURL(image);\r\n\t}\r\n};\r\n\r\nImages.prototype.download = function(id) {\r\n\tthis.room.socket.emit('image download', id);\r\n};\r\n\r\nImages.prototype.init = function()\r\n{\r\n\tvar that = this;\r\n\r\n\t$('body')\r\n\t\t.on('dragover.images', function(e){\r\n\t\t\te.preventDefault();\r\n\t\t})\r\n\t\t.on('drop.images', function(e){\r\n\t\t\te.preventDefault();\r\n\t\t\tthat.upload(e.originalEvent.dataTransfer.files[0]);\r\n\t\t})\r\n\t\t.on('click.images', '.zoomable', function(e){\r\n\t\t\te.preventDefault();\r\n\t\t\tthat.zoom($(this).attr(\"src\"));\r\n\t\t})\r\n\t\t.on('click.images', '[data-image]', function(e){\r\n\t\t\te.preventDefault();\r\n\t\t\t$(this).append(' <i class=\"fa fa-spin fa-refresh\"></i>');\r\n\t\t\tthat.download($(this).attr(\"data-image\"));\r\n\t\t});\r\n\r\n\tthis.room.socket.on('image', function(data){\r\n\t\tthat.show(data);\r\n\t});\r\n};\r\n\r\nImages.prototype.destroy = function()\r\n{\r\n\tthis.close();\r\n\t$('body').off('.images');\r\n};","function LocalPlayer(music)\r\n{\r\n\tthis.music = music;\r\n\tthis.audio = new Audio();\r\n\tthis.volet = 0;\r\n\tthis.init();\r\n}\r\n\r\nLocalPlayer.prototype.init = function(){\r\n\tvar that = this;\r\n\tdocument.body.appendChild(this.audio);\r\n\tthis.audio.autoplay = true;\r\n\tthis.audio.loop = true;\r\n\r\n\tif(that.music.room.user.admin){\r\n\t\t$.post('music/list.php', function(data){\r\n\t\t\tthat.music.$musicPopin.find('.local-contener').append(that.crawlSongs(data));\r\n\r\n\t\t\t$('body').on('click.music', '.song .fa-play', function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthat.song($(this).parent().parent(), false);\r\n\t\t\t});\r\n\r\n\t\t\t$('body').on('click.music', '.song .fa-plus', function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthat.song($(this).parent().parent(), true);\r\n\t\t\t});\r\n\r\n\t\t\t$('body').on('click.music', '.playlist .fa-play', function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthat.playlist($(this).parent().parent(), false);\r\n\t\t\t});\r\n\r\n\t\t\t$('body').on('click.music', '.playlist .fa-plus', function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthat.playlist($(this).parent().parent(), true);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n};\r\n\r\nLocalPlayer.prototype.song = function(elem, add){\r\n\tvar that = this;\r\n\tthat.music.$musicPopin.fadeOut(300);\r\n\tvar songs = {\r\n\t\ttype: 'local',\r\n\t\tadd: add,\r\n\t\turl: [elem.attr('data-song')]\r\n\t};\r\n\tthat.music.room.socket.emit('music', songs);\r\n};\r\n\r\nLocalPlayer.prototype.playlist = function(elem, add){\r\n\tvar that = this;\r\n\tvar songs = {\r\n\t\ttype: 'local',\r\n\t\tadd: add,\r\n\t\turl: []\r\n\t};\r\n\tthat.music.$musicPopin.fadeOut(300);\r\n\telem.next('input').next('label').next('ul').find('.song').each(function(){\r\n\t\tsongs.url.push($(this).attr('data-song'));\r\n\t});\r\n\r\n\tthat.music.room.socket.emit('music', songs);\r\n};\r\n\r\nLocalPlayer.prototype.crawlSongs = function(playlist){\r\n\t++this.volet;\r\n\tvar musiclist = '';\r\n\tmusiclist += '<h4 class=\"playlist list link\">'+playlist.title+'<span class=\"icon-play\"><i class=\"fa fa-plus\"></i><i class=\"fa fa-play\"></i></span></h4>';\r\n\tmusiclist += '<input id=\"volet-'+this.volet+'\" type=\"checkbox\" '+((this.volet==1)?'checked':'')+' class=\"volet-checkbox\">';\r\n\tmusiclist += '<label for=\"volet-'+this.volet+'\" class=\"volet-btn link fa fa-caret-right\"></label>';\r\n\tmusiclist += '<ul class=\"volet-content\">';\r\n\tfor(var i = 0; i < playlist.songs.length; i++){\r\n\t\tif(playlist.songs[i].type == \"playlist\"){\r\n\t\t\tmusiclist += '<li>'+this.crawlSongs(playlist.songs[i])+'</li>';\r\n\t\t} else {\r\n\t\t\tmusiclist += '<li class=\"song list link\" data-song=\"music/'+playlist.songs[i].url+'\">'+playlist.songs[i].title+'<span class=\"icon-play\"><i class=\"fa fa-plus\"></i><i class=\"fa fa-play\"></i></span></li>';\r\n\t\t}\r\n\t}\r\n\tmusiclist += '</ul>';\r\n\r\n\treturn musiclist;\r\n};\r\n\r\nLocalPlayer.prototype.start = function(track){\r\n\tthis.audio.src = track.url;\r\n\tthis.play();\r\n};\r\n\r\nLocalPlayer.prototype.pause = function(){\r\n\tthis.audio.pause();\r\n};\r\n\r\nLocalPlayer.prototype.play = function(){\r\n\tthis.audio.play();\r\n};\r\n\r\nLocalPlayer.prototype.volume = function(v){\r\n\tthis.audio.volume = Math.max(0, Math.min(v, 1));\r\n};\r\n\r\nLocalPlayer.prototype.destroy = function(){\r\n\tconsole.log(this.audio);\r\n\tthis.audio.parentNode.removeChild(this.audio);\r\n};\r\n\r\nfunction YoutubePlayer(music)\r\n{\r\n\tthis.music = music;\r\n    this.index = 0;\r\n\tthis.youtube;\r\n    this.$musicUrl;\r\n    this.$playLater;\r\n    this.$playNow;\r\n\r\n\tthis.init();\r\n}\r\n\r\nYoutubePlayer.prototype.init = function(){\r\n\tvar that = this;\r\n\r\n\t// Youtube player tag\r\n\tvar tag = document.createElement('script');\r\n\ttag.src = \"https://www.youtube.com/iframe_api\";\r\n\tvar firstScriptTag = document.getElementsByTagName('script')[0];\r\n\tfirstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n\r\n\twindow.onYouTubeIframeAPIReady = function() {\r\n\t\tthat.youtube = new YT.Player('yt-player', {\r\n\t\t\theight: '1',\r\n\t\t\twidth: '1',\r\n\t\t\tevents: {\r\n\t\t\t\t'onReady': onPlayerReady,\r\n\t\t\t\t'onStateChange': onPlayerStateChange\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// 4. The API will call this function when the video player is ready.\r\n    function onPlayerReady(event) {\r\n        console.log('player ready');\r\n\r\n\t\tif(that.music.room.user.admin){\r\n\t\t\tthat.music.$musicPopin.find('.youtube-contener').append(\r\n\t\t\t\t'<div class=\"mui-form-group\">'+\r\n\t\t\t\t\t'<input id=\"music-url\" type=\"text\" class=\"mui-form-control\" placeholder=\"https://www.youtube.com/watch?v=KqeKikpLQ5o\">'+\r\n\t\t\t\t\t'<label>Youtube url</label>'+\r\n\t\t\t\t'</div>'+\r\n\t\t\t\t'<button id=\"play-later\" class=\"mui-btn mui-btn-flat mui-btn-default mui-pull-left\">To playlist</button>'+\r\n\t\t\t\t'<button id=\"play-now\" class=\"mui-btn mui-btn-raised mui-btn-primary mui-pull-right\">Play now</button>'\r\n\t\t\t);\r\n\r\n\t\t\tthat.$musicUrl = $(\"#music-url\");\r\n\t\t\tthat.$playLater = $(\"#play-later\");\r\n\t\t\tthat.$playNow = $(\"#play-now\");\r\n\r\n\t\t\tthat.$playNow.on('click.music', function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar value = that.$musicUrl[0].value;\r\n\t\t\t\tvar parse = that.parseURL(value);\r\n\t\t\t\tparse.add = false;\r\n\t\t\t\tthat.music.$musicPopin.fadeOut(300);\r\n\t\t\t\tthat.music.room.socket.emit('music', parse);\r\n\t\t\t\t//console.log('play now', parse);\r\n\t\t\t});\r\n\r\n\t\t\tthat.$playLater.on('click.music', function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar value = that.$musicUrl[0].value;\r\n\t\t\t\tvar parse = that.parseURL(value);\r\n\t\t\t\tparse.add = true;\r\n\t\t\t\tthat.music.$musicPopin.fadeOut(300);\r\n\t\t\t\tthat.music.room.socket.emit('music', parse);\r\n\t\t\t\t//console.log('play later', parse);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\r\n    function onPlayerStateChange(event) {\r\n        //console.log('event: ' + event.data, 'index: ' + that.currentIndex, 'length: ' + (event.target.getPlaylist().length-1));\r\n        if(event.data == YT.PlayerState.PLAYING)\r\n            that.index = event.target.getPlaylistIndex();\r\n        if(event.data == YT.PlayerState.ENDED && that.index == event.target.getPlaylist().length-1){\r\n            that.music.next();\r\n            //console.log('Fin de la playlist');\r\n        }\r\n    }\r\n};\r\n\r\nYoutubePlayer.prototype.parseURL = function(url)\r\n{\r\n    var type = 'video';\r\n    if(url.indexOf('list=') != -1){\r\n        url = url.replace(/(>|<)/gi,'').split(/(vi\\/|list=|\\/v\\/|youtu\\.be\\/|\\/embed\\/)/);\r\n        type = 'playlist';\r\n    } else {\r\n        url = url.replace(/(>|<)/gi,'').split(/(vi\\/|v=|\\/v\\/|youtu\\.be\\/|\\/embed\\/)/);\r\n    }\r\n\r\n    if(url[2] !== undefined)\r\n        url = url[2].split(/[^0-9a-z_\\-]/i);\r\n\r\n    return {\r\n        url: url[0],\r\n        type: type\r\n    };\r\n};\r\n\r\nYoutubePlayer.prototype.start = function(track){\r\n\tif(track.type == 'playlist') this.youtube.loadPlaylist({list: track.url});\r\n    else this.youtube.loadPlaylist(track.url);\r\n};\r\n\r\nYoutubePlayer.prototype.pause = function(){\r\n\tthis.youtube.pauseVideo();\r\n};\r\n\r\nYoutubePlayer.prototype.play = function(){\r\n\tthis.youtube.playVideo();\r\n};\r\n\r\nYoutubePlayer.prototype.volume = function(v){\r\n\tthis.youtube.setVolume(Math.max(0, Math.min(v, 1)) * 100);\r\n};\r\n\r\nYoutubePlayer.prototype.destroy = function(){\r\n\tthis.youtube.destroy();\r\n\tif(this.music.room.user.admin){\r\n\t\tthis.$playNow.off('.music');\r\n\t\tthis.$playLater.off('.music');\r\n\t}\r\n};\r\n\r\nfunction Music(room)\r\n{\r\n\tthis.room = room;\r\n\tthis.playlist = [];\r\n\tthis.current = 0;\r\n\tthis.savedVolume = 0;\r\n\tthis.currentVolume = 0;\r\n\tthis.localPlayer;\r\n\tthis.youtubePlayer;\r\n\tthis.player;\r\n\r\n\tthis.$play = $(\"#play\");\r\n\tthis.$mute = $(\"#mute\");\r\n\tthis.$volume = $(\"#volume\");\r\n\tthis.$bar = this.$volume.find(\".audio-volume-bar\");\r\n\tthis.$musicPlayer = $(\"#music-player\");\r\n\r\n    this.$musicPopin;\r\n\r\n\tthis.init();\r\n}\r\n\r\nMusic.prototype.load = function(data)\r\n{\r\n\tconsole.log('data', data);\r\n    if(data.add){\r\n\t\tif(data.type == 'local'){\r\n\t\t\tfor(var i = 0, l = data.url.length; i<l; i++)\r\n\t\t\t\tthis.playlist.push({type: data.type, add: data.add, url: data.url[i]});\r\n\t\t} else {\r\n\t\t\tthis.playlist.push(data);\r\n\t\t}\r\n\r\n        if(this.playlist.length == 1){\r\n            this.current = 0;\r\n            this.start();\r\n        }\r\n    } else {\r\n\t\tthis.playlist = [];\r\n\t\tif(data.type == 'local'){\r\n\t\t\tfor(var i = 0, l = data.url.length; i<l; i++)\r\n\t\t\t\tthis.playlist.push({type: data.type, add: data.add, url: data.url[i]});\r\n\t\t} else {\r\n\t\t\tthis.playlist.push(data);\r\n\t\t}\r\n\t\tthis.current = 0;\r\n        this.start();\r\n    }\r\n};\r\n\r\nMusic.prototype.start = function()\r\n{\r\n\tconsole.log(this.playlist);\r\n    if(this.playlist.length === 0)\r\n        return;\r\n\tif(this.playlist[this.current].type == 'local')\r\n\t\tthis.player = this.localPlayer;\r\n\telse\r\n\t\tthis.player = this.youtubePlayer;\r\n\r\n    this.player.start(this.playlist[this.current]);\r\n    this.play();\r\n};\r\n\r\nMusic.prototype.next = function()\r\n{\r\n\tif(++this.current >= this.playlist.length)\r\n\t\tthis.current = 0;\r\n\tthis.start();\r\n};\r\n\r\nMusic.prototype.play = function()\r\n{\r\n\tthis.$play\r\n\t\t.removeClass(\"fa-play\")\r\n\t\t.addClass(\"fa-pause\");\r\n\tthis.player.play();\r\n\tthis.volume(this.currentVolume);\r\n};\r\n\r\nMusic.prototype.pause = function()\r\n{\r\n\tthis.$play\r\n\t\t.removeClass(\"fa-pause\")\r\n\t\t.addClass(\"fa-play\");\r\n\tthis.player.pause();\r\n};\r\n\r\nMusic.prototype.volume = function(volume)\r\n{\r\n\tvolume = Math.min(Math.max(volume, 0), 1);\r\n\r\n\tvar c = \"fa \";\r\n\tif(volume == 0){\r\n\t\tc += \"fa-volume-off\";\r\n\t} else if(volume < 0.4){\r\n\t\tc += \"fa-volume-down\";\r\n\t} else {\r\n\t\tc += \"fa-volume-up\";\r\n\t}\r\n\r\n\tthis.$mute[0].className = c;\r\n\r\n\tthis.$bar.css('width', (volume*100)+'%');\r\n\r\n\tif(this.player)\r\n\t\tthis.player.volume(volume * 0.2);\r\n    this.currentVolume = volume;\r\n};\r\n\r\nMusic.prototype.mute = function()\r\n{\r\n\tthis.savedVolume = this.currentVolume;\r\n\tthis.volume(0);\r\n};\r\n\r\nMusic.prototype.unmute = function()\r\n{\r\n\tthis.volume(this.savedVolume);\r\n\tthis.savedVolume = 0;\r\n};\r\n\r\nMusic.prototype.init = function()\r\n{\r\n\tvar that = this;\r\n\r\n\tthat.youtubePlayer = new YoutubePlayer(that);\r\n\tthat.localPlayer = new LocalPlayer(that);\r\n\r\n    that.volume(0.5);\r\n\r\n    that.$volume.on('mousedown.music', function(e){\r\n        e.preventDefault();\r\n        that.volume(Math.round(e.offsetX/$(this).width()*100)/100);\r\n        $(window).on('mousemove.music', function(e){\r\n            var offset = e.clientX - that.$volume.offset().left;\r\n            that.volume(Math.round(offset/that.$volume.width()*100)/100);\r\n        });\r\n    });\r\n\r\n    that.$mute.on('click.music', function(){\r\n        if(that.savedVolume == 0){\r\n            that.mute();\r\n        } else {\r\n            that.unmute();\r\n        }\r\n    });\r\n\r\n    $(window).on('mouseup.music', function(){\r\n        $(window).off('mousemove.music');\r\n    });\r\n\r\n    that.room.socket.on('music', function(data){\r\n        that.load(data);\r\n    });\r\n\r\n    that.room.socket.on('music pause', function(){\r\n        that.pause();\r\n    });\r\n\r\n    that.room.socket.on('music play', function(){\r\n        that.play();\r\n    });\r\n\r\n    that.room.socket.on('music volume', function(data){\r\n        that.volume(data);\r\n    });\r\n\r\n    if(that.room.user.admin)\r\n    {\r\n        $('.room-wrapper').append('<div id=\"music-player\"><div class=\"music-title\">Click to choose song</div></div>');\r\n\r\n        $('.room-wrapper').append('<div class=\"music-selector overlay centerer\" style=\"display:none;\">'+\r\n            '<div class=\"popin mui-panel centered\">'+\r\n                '<i class=\"music-selector-close popin-close fa fa-times link\"></i>'+\r\n\t\t\t\t'<div class=\"youtube-contener\"></div>'+\r\n\t\t\t\t'<div class=\"local-contener\" style=\"position:relative;clear:both;\"></div>'+\r\n            '</div>'+\r\n        '</div>');\r\n\r\n        that.$musicPlayer = $(\"#music-player\");\r\n        that.$musicPopin = $(\".music-selector\");\r\n\r\n        that.$musicPlayer.on(\"click.music\", function(e){\r\n            e.preventDefault();\r\n            if(that.room.user.admin){\r\n                that.$musicPopin.fadeIn(300);\r\n            }\r\n        });\r\n\r\n        that.$play.on(\"click.music\", function(e){\r\n            e.preventDefault();\r\n            if(that.room.user.admin)\r\n            {\r\n                var $this = $(this);\r\n                if($this.hasClass('fa-play')){\r\n                    if(that.player){\r\n                        that.room.socket.emit('music play');\r\n                    } else {\r\n                        that.$musicPopin.fadeIn(300);\r\n                    }\r\n                } else {\r\n                    that.room.socket.emit('music pause');\r\n                }\r\n            }\r\n        });\r\n\r\n\t\t$('body').on(\"click.music\", \".music-selector-close\", function(){\r\n\t        that.$musicPopin.fadeOut(300);\r\n\t    });\r\n    }\r\n};\r\n\r\nMusic.prototype.destroy = function()\r\n{\r\n\tthis.youtubePlayer.destroy();\r\n\tthis.localPlayer.destroy();\r\n\r\n\tthis.$volume.off('.music');\r\n\tthis.$mute.off('.music');\r\n\tthis.$play.off('.music');\r\n\t$('body').off('.music');\r\n\t$(window).off('.music');\r\n\r\n\tthis.room.socket.removeAllListeners('music');\r\n\tthis.room.socket.removeAllListeners('music play');\r\n\tthis.room.socket.removeAllListeners('music pause');\r\n\tthis.room.socket.removeAllListeners('music volume');\r\n\r\n\tif(this.room.user.admin){\r\n\t\tthis.$musicPlayer.remove();\r\n\t\tthis.$musicPopin.remove();\r\n\t}\r\n};\r\n","function Room(socket, name, user, users, messages, options)\r\n{\r\n\tthis.socket = socket;\r\n\tthis.name = name;\r\n\tthis.user = user;\r\n\r\n\tthis.dices = new Dices(this, options.defaultDices);\r\n\tif(hasWebGLSupport()){\r\n\t\tthis.dice = new Dices3D(this, window.innerWidth, window.innerHeight);\r\n\t} else {\r\n\t\tthis.dice = new Dices2D(this, window.innerWidth, window.innerHeight);\r\n\t}\r\n\tthis.users = new Users(this, users);\r\n\tthis.images = new Images(this);\r\n\tthis.chat = new Chat(this, messages);\r\n\tthis.music = new Music(this);\r\n\tthis.options = options;\r\n\r\n\tthis.$options = $('#options');\r\n\tthis.$roomName = $(\"#room-name\");\r\n\tthis.$logout = $(\"#logout\");\r\n\r\n\tthis.optionsOpened = false;\r\n\r\n\tthis.init(users);\r\n}\r\n\r\nRoom.prototype.init = function(users)\r\n{\r\n\tvar that = this;\r\n\r\n\tthis.$roomName.text(this.name);\r\n\r\n\t// Is admin\r\n\tif(this.user.admin)\r\n\t{\r\n\t\t$(\"body\")\r\n\t\t\t.addClass('admin-layout')\r\n\t\t\t.on('click.room', '.options-save', $.proxy(that.saveOptions, that))\r\n\t\t\t.on('click.room', '.options-close', $.proxy(that.closeOptions, that));\r\n\t\tthis.$options.on('click.room', $.proxy(that.showOptions, that));\r\n\t}\r\n\r\n\t// Login out\r\n\tthis.$logout.on(\"click.room\", function(e){\r\n\t\te.preventDefault();\r\n\t\tCookies.remove('login');\r\n\t\tthat.destroy();\r\n\t\twindow.location.href = window.location.href;\r\n\t});\r\n\r\n\tthis.socket.on('change settings', function(data){\r\n\t\t//TODO: change settings without reloading\r\n\t\twindow.location.href = window.location.href;\r\n\t});\r\n\r\n\tthis.socket.on('disconnect', function(){\r\n\t\tthat.destroy();\r\n\t\twindow.location.href = window.location.href;\r\n\t});\r\n};\r\n\r\nRoom.prototype.showOptions = function()\r\n{\r\n\tvar contenu = '<div id=\"options-popin\" class=\"overlay centerer\"><div class=\"popin mui-panel centered\"><i class=\"options-close popin-close fa fa-times link\"></i>';\r\n\tcontenu += '<div class=\"mui-form-group\"><label for=\"options-dices-3d\">Use 3D dice</label><input id=\"options-dices-3d\" type=\"checkbox\"'+((this.options.dices3D) ? ' checked' : ' ')+'></div>';\r\n\tcontenu += '<div class=\"mui-form-group\"><input id=\"options-default-dices\" class=\"mui-form-control mui-empty mui-dirty\" type=\"text\" value=\"'+this.options.defaultDices.join(' ')+'\"><label>Default dice (separated by spaces)</label></div>';\r\n\tcontenu += '<div class=\"mui-form-group\"><input id=\"options-custom-roll\" class=\"mui-form-control mui-empty mui-dirty\" type=\"text\" value=\"'+this.options.customRoll+'\"><label>/dice command (custom /roll where agument are remplacing $n)</label></div>';\r\n\tcontenu += '<button class=\"options-close mui-btn mui-btn-flat mui-btn-default mui-pull-left\">Cancel</button><button class=\"options-save mui-btn mui-btn-raised mui-btn-primary mui-pull-right\">Save</button>';\r\n\tcontenu += '</div></div>';\r\n\t$('body').append(contenu);\r\n\tthis.optionsOpened = true;\r\n};\r\n\r\nRoom.prototype.saveOptions = function()\r\n{\r\n\tif(!this.user.admin)\r\n\t\treturn;\r\n\r\n\tvar options = {\r\n\t\tdices3D: $('#options-dices-3d').prop('checked'),\r\n\t\tdefaultDices: $('#options-default-dices').val().split(' '),\r\n\t\tcustomRoll: $('#options-custom-roll').val()\r\n\t};\r\n\r\n\tthis.socket.emit('save settings', options);\r\n\tthis.closeOptions();\r\n};\r\n\r\nRoom.prototype.closeOptions = function()\r\n{\r\n\tif(this.optionsOpened == false)\r\n\t\treturn;\r\n\r\n\t$('#options-popin').remove();\r\n\tthis.optionsOpened = false;\r\n};\r\n\r\nRoom.prototype.destroy = function()\r\n{\r\n\t$(\"body\")\r\n\t\t.removeClass('admin-layout')\r\n\t\t.off(\".room\");\r\n\tthis.$roomName.text(\"\");\r\n\tthis.$logout.off(\".room\");\r\n\tthis.$options.off(\".room\");\r\n\r\n\tthis.dices.destroy();\r\n\tthis.users.destroy();\r\n\tthis.chat.destroy();\r\n\tthis.music.destroy();\r\n};\r\n","function Users(room, users)\r\n{\r\n\tthis.room = room;\r\n\tthis.users = [];\r\n\tthis.grabbed = null;\r\n\tthis.ghost = null;\r\n\r\n\tthis.$users = $(\"#users\");\r\n\tthis.item;\r\n\r\n\tthis.init(users);\r\n}\r\n\r\nUsers.prototype.getUserByName = function(name) {\r\n\tfor (var i = this.users.length - 1; i >= 0; i--) {\r\n\t\tif(this.users[i].name.toLowerCase() == name.toLowerCase())\r\n\t\t\treturn this.users[i];\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nUsers.prototype.getUserById = function(id) {\r\n\tfor (var i = this.users.length - 1; i >= 0; i--) {\r\n\t\tif(this.users[i].id == id)\r\n\t\t\treturn this.users[i];\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nUsers.prototype.getIndexById = function(id) {\r\n\tfor (var i = this.users.length - 1; i >= 0; i--) {\r\n\t\tif(this.users[i].id == id)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\nUsers.prototype.showUser = function(user)\r\n{\r\n\tvar c = \"user\";\r\n\tif(user.admin) c += \" admin\";\r\n\tif(user.name == this.room.user.name) c += \" me\";\r\n\r\n\tvar $caracs =\r\n\t\t'<div class=\"user-details mui-panel\">' +\r\n\t\t\t'<!--<div class=\"title\"><strong>Characteristics</strong></div>' +\r\n\t\t\t'<div class=\"user-health noselect\" data-carac=\"health\"><i class=\"fa fa-heart\"></i> <span>8</span></div>' +\r\n\t\t\t'<div class=\"user-defense noselect\" data-carac=\"defense\"><i class=\"fa fa-shield\"></i> <span>8</span></div>-->' +\r\n\t\t\t'<div class=\"title\"><strong>Tokens</strong></div>' +\r\n\t\t\t'<div class=\"user-tokens\"></div>' +\r\n\t\t'</div>';\r\n\r\n\tvar $user = '<li data-user=\"'+user.id+'\" data-sort=\"'+user.order+'\" class=\"user-item '+c+'\" id=\"user-'+user.id+'\">'+user.name+'<span class=\"user-dice\"></span>'+$caracs+'</li>';\r\n\r\n\tif(user.admin) {\r\n\t\tthis.$users.prepend($user);\r\n\t} else {\r\n\t\tthis.$users.append($user);\r\n\t}\r\n\r\n\tthis.refreshTokens(user);\r\n};\r\n\r\nUsers.prototype.addUser = function(user)\r\n{\r\n\tif(user.admin) {\r\n\t\tthis.users.unshift(user);\r\n\t} else {\r\n\t\tthis.users.push(user);\r\n\t}\r\n\r\n\tthis.showUser(user);\r\n\tthis.order();\r\n};\r\n\r\nUsers.prototype.removeUser = function(user)\r\n{\r\n\tvar index = this.getIndexById(user.id);\r\n\tif(index >= 0)\r\n\t\tthis.users.splice(index, 1);\r\n\r\n\t$(\"#user-\"+user.id).remove();\r\n\tthis.order();\r\n};\r\n\r\nUsers.prototype.refreshTokens = function(user)\r\n{\r\n\tu = this.getUserById(user.id);\r\n\tif(u){\r\n\t\tu.tokens = user.tokens;\r\n\t\tvar ts = $(\"#user-\"+user.id+\" .user-tokens\");\r\n\t\tvar tok = \"\";\r\n\r\n\t\tfor(var t in u.tokens){\r\n\t\t\ttok += '<div class=\"token '+t+'\" data-user=\"'+user.id+'\" data-token=\"'+t+'\">'+u.tokens[t]+'</div>';\r\n\t\t}\r\n\r\n\t\tif(tok == \"\"){\r\n\t\t\tts.html('<div class=\"notoken\">No tokens</div>');\r\n\t\t} else {\r\n\t\t\tts.html(tok);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nUsers.prototype.typingStart = function(user)\r\n{\r\n\t$(\"#user-\"+user.id).addClass(\"typing\");\r\n};\r\n\r\nUsers.prototype.typingStop = function(user)\r\n{\r\n\t$(\"#user-\"+user.id).removeClass(\"typing\");\r\n};\r\n\r\nUsers.prototype.showLastDice = function(user, dice)\r\n{\r\n\t$(\"#user-\"+user.id).find(\".user-dice\").html(dice);\r\n};\r\n\r\nUsers.prototype.grab = function(elem, position)\r\n{\r\n\tif(this.grabbed !== null || !this.room.user.admin || elem.hasClass('admin'))\r\n\t\treturn;\r\n\r\n\tvar self = this;\r\n\t$('body').addClass('grabbing');\r\n\tthis.ghost = elem.clone()\r\n\t\t.css({\r\n\t\t\tposition: \"absolute\",\r\n\t\t\ttop: \"0\",\r\n\t\t\tleft: \"0\",\r\n\t\t\twidth: elem.outerWidth()+'px',\r\n\t\t\ttransform: \"translate(\"+position.x+\"px, \"+position.y+\"px)\"\r\n\t\t})\r\n\t\t.appendTo('body');\r\n\tthis.grabbed = elem.addClass('grabbing');\r\n\r\n\t$('body').on('mouseup.sortable', function(e){\r\n\t\te.preventDefault();\r\n\t\tself.release({x:e.pageX, y:e.pageY});\r\n\t});\r\n\r\n\t$('body').on('mousemove.sortable', function(e){\r\n\t\te.preventDefault();\r\n\t\tself.grabbing({x:e.pageX, y:e.pageY});\r\n\t});\r\n};\r\n\r\nUsers.prototype.grabbing = function(position)\r\n{\r\n\tif(this.grabbed === null)\r\n\t\treturn;\r\n\r\n\tvar self = this;\r\n\tthis.ghost.css(\"transform\", \"translate(\"+position.x+\"px, \"+position.y+\"px)\");\r\n\r\n\tthis.items.each(function(){\r\n\t\tvar $this = $(this);\r\n\t\tif(!$this.hasClass('grabbing') && !$this.hasClass('admin')){\r\n\t\t\tvar top = $this.offset().top;\r\n\t\t\tvar height = $this.outerHeight();\r\n\t\t\tif(top < position.y && position.y< top + height){\r\n\t\t\t\t// if is in range\r\n\t\t\t\tif(position.y> top + height / 2){\r\n\t\t\t\t\tself.grabbed.after($this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.grabbed.before($this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\n\r\nUsers.prototype.release = function()\r\n{\r\n\tif(this.grabbed === null)\r\n\t\treturn;\r\n\r\n\t$('body').removeClass('grabbing');\r\n\tthis.grabbed.removeClass('grabbing');\r\n\tthis.grabbed = null;\r\n\tthis.ghost.remove();\r\n\tthis.ghost = null;\r\n\t$('body').off('.sortable');\r\n\r\n\tif(this.room.user.admin)\r\n\t\tthis.ordering();\r\n};\r\n\r\nUsers.prototype.order = function()\r\n{\r\n\tvar that = this;\r\n\tthis.items = this.$users.find('.user').sort(function(a, b){\r\n\t\treturn parseInt($(a).data('sort'), 10) - parseInt($(b).data('sort'), 10);\r\n\t}).each(function(index){\r\n\t\tvar order = $(this).data('sort');\r\n\t\tthat.$users.append($(this));\r\n\t});\r\n};\r\n\r\nUsers.prototype.ordering = function()\r\n{\r\n\tvar data = {};\r\n\tthis.items = this.$users.find('.user');\r\n\tthis.items.each(function(index){\r\n\t\t$(this).data('sort', index);\r\n\t\tvar id = $(this).data('user');\r\n\t\tif(id && index)\r\n\t\t\tdata[id] = index;\r\n\t});\r\n\r\n\tthis.room.socket.emit('user order', data);\r\n};\r\n\r\nUsers.prototype.sort = function(list)\r\n{\r\n\tfor(var l in list){\r\n\t\tl = parseInt(l, 10);\r\n\t\tvar user = this.getUserById(l);\r\n\t\tif(user){\r\n\t\t\tuser.order = parseInt(list[l], 10);\r\n\t\t\t$(\"#user-\"+l).data('sort', list[l]);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.order();\r\n};\r\n\r\nUsers.prototype.init = function(users)\r\n{\r\n\tvar that = this;\r\n\r\n\t// Setup users\r\n\tfor(var i = 0, length = users.length; i < length; i++){\r\n\t\tvar user = users[i];\r\n\t\tif(user.connected){\r\n\t\t\tif(user.name.toLowerCase() == this.room.user.name.toLowerCase()){\r\n\t\t\t\tuser = this.room.user;\r\n\t\t\t}\r\n\r\n\t\t\tthis.addUser(user);\r\n\t\t\tthis.refreshTokens(user);\r\n\t\t}\r\n\t}\r\n\r\n\t// Users connexions\r\n\tthis.room.socket.on('user login', function(data){\r\n\t\tthat.addUser(data);\r\n\t});\r\n\r\n\tthis.room.socket.on('user logout', function(data){\r\n\t\tthat.removeUser(data);\r\n\t});\r\n\r\n\t// Users typing\r\n\tthis.room.socket.on('typing start', function(data){\r\n\t\tthat.typingStart(data);\r\n\t});\r\n\r\n\tthis.room.socket.on('typing stop', function(data){\r\n\t\tthat.typingStop(data);\r\n\t});\r\n\r\n\t// User token\r\n\tthis.room.socket.on('token give', function(data){\r\n\t\tthat.refreshTokens(data);\r\n\t});\r\n\r\n\tthis.room.socket.on('token use', function(data, token){\r\n\t\tthat.refreshTokens(data);\r\n\t\tvar token = $(\r\n\t\t\t'<div id=\"token-popin-'+data.id+'\" class=\"before overlay centerer\">'+\r\n\t\t\t\t'<div class=\"popin centered mui-panel text-align-center\">'+\r\n\t\t\t\t\t'<h3>'+data.name+' use '+token+' token</h3>'+\r\n\t\t\t\t\t'<div class=\"'+token+' token big\">&nbsp;</div>'+\r\n\t\t\t\t'</div>'+\r\n\t\t\t'</div>');\r\n\t\t$('body').append(token);\r\n\r\n\t\ttoken.delay(2000).fadeOut(300, function(){$(\"#token-popin-\"+data.id).remove();});\r\n\t\tsetTimeout(function(){token.removeClass('before');});\r\n\t});\r\n\r\n\t// User order\r\n\tthis.room.socket.on('user order', function(data){\r\n\t\tthat.sort(data);\r\n\t});\r\n\r\n\tif(this.room.user.admin){\r\n\t\tthis.$users.on('mousedown.sortable', '.user-details', function(e){\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t});\r\n\r\n\t\tthis.$users.on('mousedown.sortable', '.user', function(e){\r\n\t\t\te.preventDefault();\r\n\t\t\tthat.grab($(this), {x:e.pageX, y:e.pageY});\r\n\t\t});\r\n\r\n\t\t$('body').on('click.token', '#users .user .token', function(){\r\n\t\t\tthat.room.socket.emit('token use', $(this).data('user'), $(this).data('token'));\r\n\t\t});\r\n\t} else {\r\n\t\t$('body').on('click.token', '#user-'+this.room.user.id+' .token', function(){\r\n\t\t\tthat.room.socket.emit('token use', that.room.user.id, $(this).data('token'));\r\n\t\t});\r\n\t}\r\n\r\n\tthis.order();\r\n};\r\n\r\nUsers.prototype.destroy = function()\r\n{\r\n\tthis.room.socket.removeAllListeners('user login');\r\n\tthis.room.socket.removeAllListeners('user logout');\r\n\tthis.room.socket.removeAllListeners('typing start');\r\n\tthis.room.socket.removeAllListeners('typing stop');\r\n\tthis.$users.off('.sortable');\r\n\t$('body').off('.token').off('.sortable');\r\n};\r\n","(function(){\r\n\r\n\t//\r\n\t// Socket connection and login gestion\r\n\t//\r\n\r\n\tvar config = Config || {};\r\n\tvar url = config.url || 'http://localhost:3030';\r\n\tvar socket = io(url);\r\n\r\n\tvar room;\r\n\tvar loading = false;\r\n\r\n\tfunction loginRoom(item, room, user, action)\r\n\t{\r\n\t\tif(room == \"\" || user == \"\" || loading)\r\n\t\t\treturn false;\r\n\r\n\t\tloading = true;\r\n\t\titem.append('<span id=\"loading\">&nbsp;&nbsp;<i class=\"fa fa-spin fa-refresh\"></i></span>');\r\n\t\tsocket.emit(action, { room: room, user: user });\r\n\t}\r\n\r\n\t// Join room\r\n\tfunction joinRoom()\r\n\t{\r\n\t\tloginRoom($(\"#join\"), $(\"#room\").val(), $(\"#user\").val(), 'room join');\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Create room\r\n\tfunction createRoom()\r\n\t{\r\n\t\tloginRoom($(\"#create\"), $(\"#room\").val(), $(\"#user\").val(), 'room create');\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Init\r\n\tfunction init()\r\n\t{\r\n\t\t// Wait for server login event and create Room Object\r\n\t\tsocket.on('login', function(data){\r\n\t\t\tloading = false;\r\n\t\t\t$(\"#loading\").remove();\r\n\r\n\t\t\tif(!data.succes){\r\n\t\t\t\t$(\"#login-msg\").html(data.error).addClass('error');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\troom = new Room(socket, data.room.name, data.user, data.room.users, data.room.messages, data.room.settings);\r\n\t\t\tCookies.set('login', data.room.name+'|'+data.user.name, { expires: 356 });\r\n\r\n\t\t\t$(\".login-wrapper\").fadeOut(300);\r\n\t\t});\r\n\r\n\t\t// Handle click events\r\n\t\t$(\"#login\").submit(joinRoom);\r\n\t\t$(\"#join\").click(joinRoom);\r\n\t\t$(\"#create\").click(createRoom);\r\n\r\n\t\t// If cookie try to login\r\n\t\tvar cookie = Cookies.get('login');\r\n\t\tif(cookie) {\r\n\t\t\tvar ck = cookie.split(\"|\");\r\n\t\t\tloginRoom($(\"#join\"), ck[0], ck[1], 'room join');\r\n\t\t}\r\n\t}\r\n\r\n\twindow.addEventListener('DOMContentLoaded', init);\r\n})();\r\n","/*!\r\n * JavaScript Cookie v2.0.2\r\n * https://github.com/js-cookie/js-cookie\r\n *\r\n * Copyright 2006, 2015 Klaus Hartl\r\n * Released under the MIT license\r\n */\r\n(function (factory) {\r\n\tif (typeof define === 'function' && define.amd) {\r\n\t\tdefine(factory);\r\n\t} else if (typeof exports === 'object') {\r\n\t\tmodule.exports = factory();\r\n\t} else {\r\n\t\tvar _OldCookies = window.Cookies;\r\n\t\tvar api = window.Cookies = factory(window.jQuery);\r\n\t\tapi.noConflict = function () {\r\n\t\t\twindow.Cookies = _OldCookies;\r\n\t\t\treturn api;\r\n\t\t};\r\n\t}\r\n}(function () {\r\n\tfunction extend () {\r\n\t\tvar i = 0;\r\n\t\tvar result = {};\r\n\t\tfor (; i < arguments.length; i++) {\r\n\t\t\tvar attributes = arguments[ i ];\r\n\t\t\tfor (var key in attributes) {\r\n\t\t\t\tresult[key] = attributes[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction init (converter) {\r\n\t\tfunction api (key, value, attributes) {\r\n\t\t\tvar result;\r\n\r\n\t\t\t// Write\r\n\r\n\t\t\tif (arguments.length > 1) {\r\n\t\t\t\tattributes = extend({\r\n\t\t\t\t\tpath: '/'\r\n\t\t\t\t}, api.defaults, attributes);\r\n\r\n\t\t\t\tif (typeof attributes.expires === 'number') {\r\n\t\t\t\t\tvar expires = new Date();\r\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\r\n\t\t\t\t\tattributes.expires = expires;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tresult = JSON.stringify(value);\r\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\r\n\t\t\t\t\t\tvalue = result;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {}\r\n\r\n\t\t\t\tvalue = encodeURIComponent(String(value));\r\n\t\t\t\tvalue = value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\r\n\r\n\t\t\t\tkey = encodeURIComponent(String(key));\r\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\r\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\r\n\r\n\t\t\t\treturn (document.cookie = [\r\n\t\t\t\t\tkey, '=', value,\r\n\t\t\t\t\tattributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE\r\n\t\t\t\t\tattributes.path    && '; path=' + attributes.path,\r\n\t\t\t\t\tattributes.domain  && '; domain=' + attributes.domain,\r\n\t\t\t\t\tattributes.secure ? '; secure' : ''\r\n\t\t\t\t].join(''));\r\n\t\t\t}\r\n\r\n\t\t\t// Read\r\n\r\n\t\t\tif (!key) {\r\n\t\t\t\tresult = {};\r\n\t\t\t}\r\n\r\n\t\t\t// To prevent the for loop in the first place assign an empty array\r\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\r\n\t\t\t// calling \"get()\"\r\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\r\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\r\n\t\t\tvar i = 0;\r\n\r\n\t\t\tfor (; i < cookies.length; i++) {\r\n\t\t\t\tvar parts = cookies[i].split('=');\r\n\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\r\n\t\t\t\tvar cookie = parts.slice(1).join('=');\r\n\r\n\t\t\t\tif (cookie.charAt(0) === '\"') {\r\n\t\t\t\t\tcookie = cookie.slice(1, -1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcookie = converter && converter(cookie, name) || cookie.replace(rdecode, decodeURIComponent);\r\n\r\n\t\t\t\t\tif (this.json) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\r\n\t\t\t\t\t\t} catch (e) {}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (key === name) {\r\n\t\t\t\t\t\tresult = cookie;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!key) {\r\n\t\t\t\t\t\tresult[name] = cookie;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tapi.get = api.set = api;\r\n\t\tapi.getJSON = function () {\r\n\t\t\treturn api.apply({\r\n\t\t\t\tjson: true\r\n\t\t\t}, [].slice.call(arguments));\r\n\t\t};\r\n\t\tapi.defaults = {};\r\n\r\n\t\tapi.remove = function (key, attributes) {\r\n\t\t\tapi(key, '', extend(attributes, {\r\n\t\t\t\texpires: -1\r\n\t\t\t}));\r\n\t\t};\r\n\r\n\t\tapi.withConverter = init;\r\n\r\n\t\treturn api;\r\n\t}\r\n\r\n\treturn init();\r\n}));\r\n\r\njQuery.fn.putCursorAtEnd = function() {\r\n\r\n  return this.each(function() {\r\n\r\n    $(this).focus()\r\n\r\n    // If this function exists...\r\n    if (this.setSelectionRange) {\r\n      // ... then use it (Doesn't work in IE)\r\n\r\n      // Double the length because Opera is inconsistent about whether a carriage return is one character or two. Sigh.\r\n      var len = $(this).val().length * 2;\r\n\r\n      this.setSelectionRange(len, len);\r\n    \r\n    } else {\r\n    // ... otherwise replace the contents with itself\r\n    // (Doesn't work in Google Chrome)\r\n\r\n      $(this).val($(this).val());\r\n      \r\n    }\r\n\r\n    // Scroll to the bottom, in case we're in a tall textarea\r\n    // (Necessary for Firefox and Google Chrome)\r\n    this.scrollTop = 999999;\r\n\r\n  });\r\n\r\n};\r\n\r\nvar hasWebGLSupport = (function(){\r\n\tvar support = false;\r\n\tvar tested = false;\r\n\treturn function(){\r\n\t\tif(!tested){\r\n\t\t\tvar gl = null;\r\n\t\t\tvar canvas = document.createElement('canvas');\r\n\t\t\ttry { gl = canvas.getContext(\"webgl\"); }\r\n\t\t\tcatch (x) { gl = null; }\r\n\r\n\t\t\tif (gl == null) {\r\n\t\t\t\ttry { gl = canvas.getContext(\"experimental-webgl\"); experimental = true; }\r\n\t\t\t\tcatch (x) { gl = null; }\r\n\t\t\t}\r\n\r\n\t\t\tif(gl == null || !window.WebGLRenderingContext){\r\n\t\t\t\tsupport = false;\r\n\t\t\t} else {\r\n\t\t\t\tsupport = true;\r\n\t\t\t}\r\n\r\n\t\t\tcanvas = null;\r\n\t\t\ttested = true;\r\n\t\t}\r\n\r\n\t\treturn support;\r\n\t}\r\n})();"]}